{"version":3,"file":"index.umd.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get menus() {\n    return this.scope.findAllElements('ul');\n  }\n\n  get isActive() {\n    return this.scope.findElement('.st-menu--opened') != null;\n  }\n\n  toggle(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        let menu = Array.from(item.children).find(child => child.matches('ul'));\n        this.closeMenu(menu);\n      } else {\n        this.openMenus(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllMenus();\n      }\n    }\n  }\n\n  open(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) {\n        this.openMenus(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllMenus();\n    }\n  }\n\n  hasMenu(item) {\n    return Array.from(item.children).some(child => child.matches('ul'));\n  }\n\n  isOpened(item) {\n    return item.matches(`.st-menu--opened`);\n  }\n\n  openMenus(item) {\n    this.closeAllMenus();\n    this.findAscMenus(item).concat(this.findChildMenus(item)).forEach(menu => this.openMenu(menu));\n  }\n\n  closeAllMenus() {\n    this.menus.forEach(menu => this.closeMenu(menu));\n  }\n\n  openMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n    }\n  }\n\n  closeMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n    }\n  }\n\n  findAscMenus(item) {\n    let menu = item.parentNode;\n    if (menu == this.element) {\n      return [menu];\n    } else if (menu && menu.parentNode) {\n      return this.findAscMenus(menu.parentNode).concat([menu]);\n    } else {\n      return [];\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n}\n"],"names":["_Class","Controller","menus","this","scope","findAllElements","isActive","findElement","toggle","e","item","target","closest","hasMenu","isOpened","menu","Array","from","children","find","child","matches","closeMenu","openMenus","focus","preventDefault","keepOpenValue","closeAllMenus","open","autoOpenValue","closeAll","element","contains","some","findAscMenus","concat","findChildMenus","forEach","openMenu","parentNode","classList","add","remove","filter","values","autoOpen","type","Boolean","default","keepOpen","actions"],"mappings":"2WAIe,MAAAA,UAAcC,EAAWA,WAWtC,SAAIC,GACF,OAAWC,KAACC,MAAMC,gBAAgB,KACpC,CAEA,YAAIC,GACF,OAAqD,MAA9CH,KAAKC,MAAMG,YAAY,mBAChC,CAEAC,MAAAA,CAAOC,GACL,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MAC5B,GAAIF,GAAQP,KAAKU,QAAQH,GAAO,CAC9B,GAAIP,KAAKW,SAASJ,GAAO,CACvB,IAAIK,EAAOC,MAAMC,KAAKP,EAAKQ,UAAUC,KAAKC,GAASA,EAAMC,QAAQ,OACjElB,KAAKmB,UAAUP,EACjB,MACEZ,KAAKoB,UAAUb,GACfD,EAAEE,OAAOa,QAEXf,EAAEgB,gBACJ,MACOtB,KAAKuB,eACRvB,KAAKwB,eAGX,CAEAC,IAAAA,CAAKnB,GACH,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBF,GAAQP,KAAKU,QAAQH,MACnBP,KAAKG,UAAYH,KAAK0B,iBACxB1B,KAAKoB,UAAUb,GACfD,EAAEE,OAAOa,SAEXf,EAAEgB,iBAEN,CAEAK,QAAAA,CAASrB,GACFN,KAAK4B,QAAQC,SAASvB,EAAEE,SAC3BR,KAAKwB,eAET,CAEAd,OAAAA,CAAQH,GACN,OAAOM,MAAMC,KAAKP,EAAKQ,UAAUe,KAAKb,GAASA,EAAMC,QAAQ,MAC/D,CAEAP,QAAAA,CAASJ,GACP,OAAOA,EAAKW,QAA0B,mBACxC,CAEAE,SAAAA,CAAUb,GACRP,KAAKwB,gBACLxB,KAAK+B,aAAaxB,GAAMyB,OAAOhC,KAAKiC,eAAe1B,IAAO2B,QAAQtB,GAAQZ,KAAKmC,SAASvB,GAC1F,CAEAY,aAAAA,GACExB,KAAKD,MAAMmC,QAAQtB,GAAQZ,KAAKmB,UAAUP,GAC5C,CAEAuB,QAAAA,CAASvB,GACP,IAAIL,EAAOK,EAAKwB,WACZ7B,GAAQP,KAAK4B,QAAQC,SAAStB,IAChCA,EAAK8B,UAAUC,IAAI,kBAEvB,CAEAnB,SAAAA,CAAUP,GACR,IAAIL,EAAOK,EAAKwB,WACZ7B,GAAQP,KAAK4B,QAAQC,SAAStB,IAChCA,EAAK8B,UAAUE,OAAO,kBAE1B,CAEAR,YAAAA,CAAaxB,GACX,IAAIK,EAAOL,EAAK6B,WAChB,OAAIxB,GAAQZ,KAAK4B,QACR,CAAChB,GACCA,GAAQA,EAAKwB,WACfpC,KAAK+B,aAAanB,EAAKwB,YAAYJ,OAAO,CAACpB,IAE3C,EAEX,CAEAqB,cAAAA,CAAe1B,GACb,OAAOM,MAAMC,KAAKP,EAAKQ,UAAUyB,OAAOvB,GAASA,EAAMC,QAAQ,MACjE,SACDrB,EAlGQ4C,OAAS,CACdC,SAAU,CAAEC,KAAMC,QAASC,SAAS,GACpCC,SAAU,CAAEH,KAAMC,QAASC,SAAS,IACrChD,EACMkD,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,0BACZ,CAAC,UAAW"}