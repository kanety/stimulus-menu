{"version":3,"file":"index.module.mjs","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false },\n    toggleElement: { type: String, default: 'a' }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get rootItems() {\n    return Array.from(this.element.children).filter(child => child.matches('li'));\n  }\n\n  get items() {\n    return this.rootItems.flatMap(rootItem => this.findDescendants(rootItem));\n  }\n\n  get isActive() {\n    return this.items.find(item => this.isOpened(item)) != undefined;\n  }\n\n  toggle(e) {\n    if (!this.isToggleElement(e.target)) return;\n\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        this.closeItem(item);\n      } else {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllItems();\n      }\n    }\n  }\n\n  open(e) {\n    if (!this.isToggleElement(e.target)) return;\n\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllItems();\n    }\n  }\n\n  isToggleElement(target) {\n    return target.matches(this.toggleElementValue);\n  }\n\n  hasMenu(item) {\n    return this.findChildMenus(item).length != 0;\n  }\n\n  isOpened(item) {\n    return item.matches('.st-menu--opened');\n  }\n\n  isClosed(item) {\n    return !this.isOpened(item);\n  }\n\n  openItemsFrom(item) {\n    let targetItems = this.findAscendants(item).concat([item]);\n    this.items.forEach(item => {\n      if (!targetItems.includes(item)) this.closeItem(item);\n    });\n    targetItems.forEach(item => this.openItem(item));\n  }\n\n  closeAllItems() {\n    this.items.forEach(item => this.closeItem(item));\n  }\n\n  openItem(item) {\n    if (item && this.isClosed(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n      this.dispatch('opened', { detail: { item: item } });\n    }\n  }\n\n  closeItem(item) {\n    if (item && this.isOpened(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n      this.dispatch('closed', { detail: { item: item } });\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n\n  findAscendants(item) {\n    let parent = item.parentNode?.parentNode;\n    if (parent && this.scope.containsElement(parent)) {\n      return this.findAscendants(parent).concat([item]);\n    } else {\n      return [item];\n    }\n  }\n\n  findDescendants(item) {\n    return [item].concat(this.findChildren(item).flatMap(child => this.findDescendants(child)));\n  }\n\n  findChildren(item) {\n    return this.findChildMenus(item).flatMap(menu => {\n      return Array.from(menu.children).filter(child => child.matches('li'));\n    });\n  }\n}\n"],"names":["_Class","Controller","rootItems","Array","from","this","element","children","filter","child","matches","items","flatMap","rootItem","findDescendants","isActive","undefined","find","item","isOpened","toggle","e","isToggleElement","target","closest","hasMenu","closeItem","openItemsFrom","focus","preventDefault","keepOpenValue","closeAllItems","open","autoOpenValue","closeAll","contains","toggleElementValue","findChildMenus","length","isClosed","targetItems","findAscendants","concat","forEach","includes","openItem","classList","add","dispatch","detail","remove","_item$parentNode","parent","parentNode","scope","containsElement","findChildren","menu","values","autoOpen","type","Boolean","default","keepOpen","toggleElement","String","actions"],"mappings":"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"}