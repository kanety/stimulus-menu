{"version":3,"file":"index.module.mjs","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get menus() {\n    return this.scope.findAllElements('ul');\n  }\n\n  get isActive() {\n    return this.scope.findElement('.st-menu--opened') != null;\n  }\n\n  toggle(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        let menus = this.findChildMenus(item);\n        menus.forEach(menu => this.closeMenu(menu));\n      } else {\n        this.openMenus(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllMenus();\n      }\n    }\n  }\n\n  open(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) {\n        this.openMenus(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllMenus();\n    }\n  }\n\n  hasMenu(item) {\n    return this.findChildMenus(item).length != 0;\n  }\n\n  isOpened(item) {\n    return item.matches(`.st-menu--opened`);\n  }\n\n  isClosed(item) {\n    return !this.isOpened(item);\n  }\n\n  openMenus(item) {\n    let targetMenus = this.findAscMenus(item).concat(this.findChildMenus(item));\n    this.menus.forEach(menu => {\n      if (!targetMenus.includes(menu)) this.closeMenu(menu);\n    });\n    targetMenus.forEach(menu => this.openMenu(menu));\n  }\n\n  closeAllMenus() {\n    this.menus.forEach(menu => this.closeMenu(menu));\n  }\n\n  openMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.isClosed(item) && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n    }\n  }\n\n  closeMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.isOpened(item) && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n    }\n  }\n\n  findAscMenus(item) {\n    let menu = item.parentNode;\n    if (menu == this.element) {\n      return [menu];\n    } else if (menu && menu.parentNode) {\n      return this.findAscMenus(menu.parentNode).concat([menu]);\n    } else {\n      return [];\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n}\n"],"names":["_Class","Controller","menus","this","scope","findAllElements","isActive","findElement","toggle","e","item","target","closest","hasMenu","isOpened","findChildMenus","forEach","menu","closeMenu","openMenus","focus","preventDefault","keepOpenValue","closeAllMenus","open","autoOpenValue","closeAll","element","contains","length","matches","isClosed","targetMenus","findAscMenus","concat","includes","openMenu","parentNode","classList","add","remove","Array","from","children","filter","child","values","autoOpen","type","Boolean","default","keepOpen","actions"],"mappings":"wFAIeA,MAAAA,UAAcC,EAW3B,SAAIC,GACF,OAAOC,KAAKC,MAAMC,gBAAgB,KACpC,CAEA,YAAIC,GACF,OAAqD,MAA9CH,KAAKC,MAAMG,YAAY,mBAChC,CAEAC,MAAAA,CAAOC,GACL,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBF,GAAQP,KAAKU,QAAQH,IACnBP,KAAKW,SAASJ,GACJP,KAAKY,eAAeL,GAC1BM,QAAQC,GAAQd,KAAKe,UAAUD,KAErCd,KAAKgB,UAAUT,GACfD,EAAEE,OAAOS,SAEXX,EAAEY,kBAEGlB,KAAKmB,eACRnB,KAAKoB,eAGX,CAEAC,IAAAA,CAAKf,GACH,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBF,GAAQP,KAAKU,QAAQH,MACnBP,KAAKG,UAAYH,KAAKsB,iBACxBtB,KAAKgB,UAAUT,GACfD,EAAEE,OAAOS,SAEXX,EAAEY,iBAEN,CAEAK,QAAAA,CAASjB,GACFN,KAAKwB,QAAQC,SAASnB,EAAEE,SAC3BR,KAAKoB,eAET,CAEAV,OAAAA,CAAQH,GACN,OAA2C,QAA/BK,eAAeL,GAAMmB,MACnC,CAEAf,QAAAA,CAASJ,GACP,OAAOA,EAAKoB,QAAO,mBACrB,CAEAC,QAAAA,CAASrB,GACP,OAAQP,KAAKW,SAASJ,EACxB,CAEAS,SAAAA,CAAUT,GACR,IAAIsB,EAAc7B,KAAK8B,aAAavB,GAAMwB,OAAO/B,KAAKY,eAAeL,IACrEP,KAAKD,MAAMc,QAAQC,IACZe,EAAYG,SAASlB,IAAOd,KAAKe,UAAUD,EAAI,GAEtDe,EAAYhB,QAAQC,GAAQd,KAAKiC,SAASnB,GAC5C,CAEAM,aAAAA,GACEpB,KAAKD,MAAMc,QAAQC,GAAQd,KAAKe,UAAUD,GAC5C,CAEAmB,QAAAA,CAASnB,GACP,IAAIP,EAAOO,EAAKoB,WACZ3B,GAAQP,KAAK4B,SAASrB,IAASP,KAAKwB,QAAQC,SAASlB,IACvDA,EAAK4B,UAAUC,IAAI,kBAEvB,CAEArB,SAAAA,CAAUD,GACR,IAAIP,EAAOO,EAAKoB,WACZ3B,GAAQP,KAAKW,SAASJ,IAASP,KAAKwB,QAAQC,SAASlB,IACvDA,EAAK4B,UAAUE,OAAO,kBAE1B,CAEAP,YAAAA,CAAavB,GACX,IAAIO,EAAOP,EAAK2B,WAChB,OAAIpB,GAAQd,KAAKwB,QACR,CAACV,GACCA,GAAQA,EAAKoB,WACXlC,KAAC8B,aAAahB,EAAKoB,YAAYH,OAAO,CAACjB,IAE3C,EAEX,CAEAF,cAAAA,CAAeL,GACb,OAAO+B,MAAMC,KAAKhC,EAAKiC,UAAUC,OAAOC,GAASA,EAAMf,QAAQ,MACjE,EACD9B,EAzGQ8C,OAAS,CACdC,SAAU,CAAEC,KAAMC,QAASC,SAAS,GACpCC,SAAU,CAAEH,KAAMC,QAASC,SAAS,IACrClD,EACMoD,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,0BACZ,CAAC,UAAW"}