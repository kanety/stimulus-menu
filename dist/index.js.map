{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false },\n    toggleElement: { type: String, default: 'a' }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get rootItems() {\n    return Array.from(this.element.children).filter(child => child.matches('li'));\n  }\n\n  get items() {\n    return this.rootItems.flatMap(rootItem => this.findDescendants(rootItem));\n  }\n\n  get isActive() {\n    return this.items.find(item => this.isOpened(item)) != undefined;\n  }\n\n  toggle(e) {\n    if (!this.isToggleElement(e.target)) return;\n\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        this.closeItem(item);\n      } else {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllItems();\n      }\n    }\n  }\n\n  open(e) {\n    if (!this.isToggleElement(e.target)) return;\n\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllItems();\n    }\n  }\n\n  enable(e) {\n    let targetItem = e.target.closest('li');\n    this.findDescendants(targetItem).forEach(item => this.enableItem(item));\n  }\n\n  disable(e) {\n    let targetItem = e.target.closest('li');\n    this.findDescendants(targetItem).forEach(item => this.disableItem(item));\n  }\n\n  isToggleElement(target) {\n    return target.matches(this.toggleElementValue);\n  }\n\n  hasMenu(item) {\n    return this.findChildMenus(item).length != 0;\n  }\n\n  isOpened(item) {\n    return item.matches('.st-menu--opened');\n  }\n\n  isClosed(item) {\n    return !this.isOpened(item);\n  }\n\n  openItemsFrom(item) {\n    let targetItems = this.findAscendants(item).concat([item]);\n    this.items.forEach(item => {\n      if (!targetItems.includes(item)) this.closeItem(item);\n    });\n    targetItems.forEach(item => this.openItem(item));\n  }\n\n  closeAllItems() {\n    this.items.forEach(item => this.closeItem(item));\n  }\n\n  openItem(item) {\n    if (item && this.isClosed(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n      this.dispatch('opened', { detail: { item: item } });\n    }\n  }\n\n  closeItem(item) {\n    if (item && this.isOpened(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n      this.dispatch('closed', { detail: { item: item } });\n    }\n  }\n\n  enableItem(item) {\n    item.classList.remove('st-menu__item--disabled');\n    this.findContents(item).forEach(content => {\n      [content, ...content.querySelectorAll('*')].forEach(elem => {\n        if (elem.matches('a')) {\n          elem.tabIndex = null;\n        } else if (elem.matches('input, textarea, select, button')) {\n          elem.disabled = false;\n        }\n      });\n    });\n  }\n\n  disableItem(item) {\n    item.classList.add('st-menu__item--disabled');\n    this.findContents(item).forEach(content => {\n      [content, ...content.querySelectorAll('*')].forEach(elem => {\n        if (elem.matches('a')) {\n          elem.tabIndex = '-1';\n        } else if (elem.matches('input, textarea, select, button')) {\n          elem.disabled = true;\n        }\n      });\n    });\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n\n  findAscendants(item) {\n    let parent = item.parentNode?.parentNode;\n    if (parent && this.scope.containsElement(parent)) {\n      return this.findAscendants(parent).concat([item]);\n    } else {\n      return [item];\n    }\n  }\n\n  findDescendants(item) {\n    return [item].concat(this.findChildren(item).flatMap(child => this.findDescendants(child)));\n  }\n\n  findChildren(item) {\n    return this.findChildMenus(item).flatMap(menu => {\n      return Array.from(menu.children).filter(child => child.matches('li'));\n    });\n  }\n\n  findContents(item) {\n    return Array.from(item.children).filter(child => !child.matches('ul'));\n  }\n}\n"],"names":["_Class","Controller","rootItems","Array","from","this","element","children","filter","child","matches","items","flatMap","rootItem","findDescendants","isActive","undefined","find","item","isOpened","toggle","e","isToggleElement","target","closest","hasMenu","closeItem","openItemsFrom","focus","preventDefault","keepOpenValue","closeAllItems","open","autoOpenValue","closeAll","contains","enable","targetItem","forEach","enableItem","disable","disableItem","toggleElementValue","findChildMenus","length","isClosed","targetItems","findAscendants","concat","includes","openItem","classList","add","dispatch","detail","remove","findContents","content","querySelectorAll","elem","tabIndex","disabled","_item$parentNode","parent","parentNode","scope","containsElement","findChildren","menu","values","autoOpen","type","Boolean","default","keepOpen","toggleElement","String","actions"],"mappings":"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"}