{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get menus() {\n    return this.scope.findAllElements('ul');\n  }\n\n  get isActive() {\n    return this.scope.findElement('.st-menu--opened') != null;\n  }\n\n  toggle(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        let menu = Array.from(item.children).find(child => child.matches('ul'));\n        this.closeMenu(menu);\n      } else {\n        this.openMenus(item);\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllMenus();\n      }\n    }\n  }\n\n  open(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) this.openMenus(item);\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllMenus();\n    }\n  }\n\n  hasMenu(item) {\n    return Array.from(item.children).some(child => child.matches('ul'));\n  }\n\n  isOpened(item) {\n    return item.matches(`.st-menu--opened`);\n  }\n\n  openMenus(item) {\n    this.closeAllMenus();\n    this.findAscMenus(item).concat(this.findChildMenus(item)).forEach(menu => this.openMenu(menu));\n  }\n\n  closeAllMenus() {\n    this.menus.forEach(menu => this.closeMenu(menu));\n  }\n\n  openMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n    }\n  }\n\n  closeMenu(menu) {\n    let item = menu.parentNode;\n    if (item && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n    }\n  }\n\n  findAscMenus(item) {\n    let menu = item.parentNode;\n    if (menu == this.element) {\n      return [menu];\n    } else if (menu && menu.parentNode) {\n      return this.findAscMenus(menu.parentNode).concat([menu]);\n    } else {\n      return [];\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n}\n"],"names":["Controller","menus","scope","findAllElements","isActive","findElement","toggle","e","item","target","closest","this","hasMenu","isOpened","menu","Array","from","children","find","child","matches","closeMenu","openMenus","preventDefault","keepOpenValue","closeAllMenus","open","autoOpenValue","closeAll","element","contains","some","findAscMenus","concat","findChildMenus","forEach","openMenu","parentNode","classList","add","remove","filter","values","autoOpen","type","Boolean","default","keepOpen","actions"],"mappings":"+FAI6BA,aAWvBC,YACF,YAAYC,MAAMC,gBAAgB,MAGhCC,eACF,OAAqD,WAAzCF,MAAMG,YAAY,oBAGhCC,OAAOC,GACL,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MAC5B,GAAIF,GAAQG,KAAKC,QAAQJ,GAAO,CAC9B,GAAIG,KAAKE,SAASL,GAAO,CACvB,IAAIM,EAAOC,MAAMC,KAAKR,EAAKS,UAAUC,KAAKC,GAASA,EAAMC,QAAQ,OACjET,KAAKU,UAAUP,QAEfH,KAAKW,UAAUd,GAEjBD,EAAEgB,sBAEGZ,KAAKa,eACRb,KAAKc,gBAKXC,KAAKnB,GACH,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBF,GAAQG,KAAKC,QAAQJ,MACnBG,KAAKP,UAAYO,KAAKgB,gBAAehB,KAAKW,UAAUd,GACxDD,EAAEgB,kBAINK,SAASrB,GACFI,KAAKkB,QAAQC,SAASvB,EAAEE,SAC3BE,KAAKc,gBAITb,QAAQJ,GACN,OAAOO,MAAMC,KAAKR,EAAKS,UAAUc,KAAKZ,GAASA,EAAMC,QAAQ,OAG/DP,SAASL,GACP,OAAOA,EAAKY,4BAGdE,UAAUd,GACRG,KAAKc,gBACLd,KAAKqB,aAAaxB,GAAMyB,OAAOtB,KAAKuB,eAAe1B,IAAO2B,QAAQrB,GAAQH,KAAKyB,SAAStB,IAG1FW,gBACEd,KAAKV,MAAMkC,QAAQrB,GAAQH,KAAKU,UAAUP,IAG5CsB,SAAStB,GACP,IAAIN,EAAOM,EAAKuB,WACZ7B,GAAQG,KAAKkB,QAAQC,SAAStB,IAChCA,EAAK8B,UAAUC,IAAI,mBAIvBlB,UAAUP,GACR,IAAIN,EAAOM,EAAKuB,WACZ7B,GAAQG,KAAKkB,QAAQC,SAAStB,IAChCA,EAAK8B,UAAUE,OAAO,mBAI1BR,aAAaxB,GACX,IAAIM,EAAON,EAAK6B,WAChB,OAAIvB,GAAQH,KAAKkB,QACR,CAACf,GACCA,GAAQA,EAAKuB,gBACVL,aAAalB,EAAKuB,YAAYJ,OAAO,CAACnB,IAE3C,GAIXoB,eAAe1B,GACb,OAAOO,MAAMC,KAAKR,EAAKS,UAAUwB,OAAOtB,GAASA,EAAMC,QAAQ,UA5F1DsB,OAAS,CACdC,SAAU,CAAEC,KAAMC,QAASC,SAAS,GACpCC,SAAU,CAAEH,KAAMC,QAASC,SAAS,MAE/BE,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,0BACZ,CAAC,UAAW"}