{"version":3,"file":"index.modern.mjs","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get rootItems() {\n    return Array.from(this.element.children).filter(child => child.matches('li'));\n  }\n\n  get items() {\n    return this.rootItems.flatMap(rootItem => this.findDescendants(rootItem));\n  }\n\n  get isActive() {\n    return this.items.find(item => this.isOpened(item)) != undefined;\n  }\n\n  toggle(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        this.closeItem(item);\n      } else {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllItems();\n      }\n    }\n  }\n\n  open(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) {\n        this.openItemsFrom(item);\n        e.target.focus();\n      }\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllItems();\n    }\n  }\n\n  hasMenu(item) {\n    return this.findChildMenus(item).length != 0;\n  }\n\n  isOpened(item) {\n    return item.matches('.st-menu--opened');\n  }\n\n  isClosed(item) {\n    return !this.isOpened(item);\n  }\n\n  openItemsFrom(item) {\n    let targetItems = this.findAscendants(item).concat([item]);\n    this.items.forEach(item => {\n      if (!targetItems.includes(item)) this.closeItem(item);\n    });\n    targetItems.forEach(item => this.openItem(item));\n  }\n\n  closeAllItems() {\n    this.items.forEach(item => this.closeItem(item));\n  }\n\n  openItem(item) {\n    if (item && this.isClosed(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.add('st-menu--opened');\n      this.dispatch('opened', { detail: { item: item } });\n    }\n  }\n\n  closeItem(item) {\n    if (item && this.isOpened(item) && this.hasMenu(item) && this.element.contains(item)) {\n      item.classList.remove('st-menu--opened');\n      this.dispatch('closed', { detail: { item: item } });\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n\n  findAscendants(item) {\n    let parent = item.parentNode?.parentNode;\n    if (parent && this.scope.containsElement(parent)) {\n      return this.findAscendants(parent).concat([item]);\n    } else {\n      return [item];\n    }\n  }\n\n  findDescendants(item) {\n    return [item].concat(this.findChildren(item).flatMap(child => this.findDescendants(child)));\n  }\n\n  findChildren(item) {\n    return this.findChildMenus(item).flatMap(menu => {\n      return Array.from(menu.children).filter(child => child.matches('li'));\n    });\n  }\n}\n"],"names":["_Class","Controller","rootItems","Array","from","this","element","children","filter","child","matches","items","flatMap","rootItem","findDescendants","isActive","undefined","find","item","isOpened","toggle","e","target","closest","hasMenu","closeItem","openItemsFrom","focus","preventDefault","keepOpenValue","closeAllItems","open","autoOpenValue","closeAll","contains","findChildMenus","length","isClosed","targetItems","findAscendants","concat","forEach","includes","openItem","classList","add","dispatch","detail","remove","_item$parentNode","parent","parentNode","scope","containsElement","findChildren","menu","values","autoOpen","type","Boolean","default","keepOpen","actions"],"mappings":"8FAIeA,UAAcC,EAW3B,aAAIC,GACF,OAAOC,MAAMC,KAAKC,KAAKC,QAAQC,UAAUC,OAAOC,GAASA,EAAMC,QAAQ,MACzE,CAEA,SAAIC,GACF,OAAWN,KAACH,UAAUU,QAAQC,GAAYR,KAAKS,gBAAgBD,GACjE,CAEA,YAAIE,GACF,OAAuDC,MAA5CX,KAACM,MAAMM,KAAKC,GAAQb,KAAKc,SAASD,GAC/C,CAEAE,MAAAA,CAAOC,GACL,IAAIH,EAAOG,EAAEC,OAAOC,QAAQ,MACxBL,GAAQb,KAAKmB,QAAQN,IACnBb,KAAKc,SAASD,GAChBb,KAAKoB,UAAUP,IAEfb,KAAKqB,cAAcR,GACnBG,EAAEC,OAAOK,SAEXN,EAAEO,kBAEGvB,KAAKwB,eACRxB,KAAKyB,eAGX,CAEAC,IAAAA,CAAKV,GACH,IAAIH,EAAOG,EAAEC,OAAOC,QAAQ,MACxBL,GAAQb,KAAKmB,QAAQN,MACnBb,KAAKU,UAAYV,KAAK2B,iBACxB3B,KAAKqB,cAAcR,GACnBG,EAAEC,OAAOK,SAEXN,EAAEO,iBAEN,CAEAK,QAAAA,CAASZ,GACFhB,KAAKC,QAAQ4B,SAASb,EAAEC,SAC3BjB,KAAKyB,eAET,CAEAN,OAAAA,CAAQN,GACN,OAA2C,QAA/BiB,eAAejB,GAAMkB,MACnC,CAEAjB,QAAAA,CAASD,GACP,OAAOA,EAAKR,QAAQ,mBACtB,CAEA2B,QAAAA,CAASnB,GACP,OAAQb,KAAKc,SAASD,EACxB,CAEAQ,aAAAA,CAAcR,GACZ,IAAIoB,EAAcjC,KAAKkC,eAAerB,GAAMsB,OAAO,CAACtB,IACpDb,KAAKM,MAAM8B,QAAQvB,IACZoB,EAAYI,SAASxB,IAAOb,KAAKoB,UAAUP,EAAI,GAEtDoB,EAAYG,QAAQvB,GAAQb,KAAKsC,SAASzB,GAC5C,CAEAY,aAAAA,GACEzB,KAAKM,MAAM8B,QAAQvB,GAAQb,KAAKoB,UAAUP,GAC5C,CAEAyB,QAAAA,CAASzB,GACHA,GAAQb,KAAKgC,SAASnB,IAASb,KAAKmB,QAAQN,IAASb,KAAKC,QAAQ4B,SAAShB,KAC7EA,EAAK0B,UAAUC,IAAI,mBACnBxC,KAAKyC,SAAS,SAAU,CAAEC,OAAQ,CAAE7B,KAAMA,KAE9C,CAEAO,SAAAA,CAAUP,GACJA,GAAQb,KAAKc,SAASD,IAASb,KAAKmB,QAAQN,IAASb,KAAKC,QAAQ4B,SAAShB,KAC7EA,EAAK0B,UAAUI,OAAO,mBACtB3C,KAAKyC,SAAS,SAAU,CAAEC,OAAQ,CAAE7B,KAAMA,KAE9C,CAEAiB,cAAAA,CAAejB,GACb,OAAOf,MAAMC,KAAKc,EAAKX,UAAUC,OAAOC,GAASA,EAAMC,QAAQ,MACjE,CAEA6B,cAAAA,CAAerB,GAAM+B,IAAAA,EACnB,IAAIC,EAAwB,OAAlBD,EAAG/B,EAAKiC,iBAAU,EAAfF,EAAiBE,WAC9B,OAAID,GAAU7C,KAAK+C,MAAMC,gBAAgBH,GAC5B7C,KAACkC,eAAeW,GAAQV,OAAO,CAACtB,IAEpC,CAACA,EAEZ,CAEAJ,eAAAA,CAAgBI,GACd,MAAO,CAACA,GAAMsB,OAAOnC,KAAKiD,aAAapC,GAAMN,QAAQH,GAASJ,KAAKS,gBAAgBL,IACrF,CAEA6C,YAAAA,CAAapC,GACX,OAAWb,KAAC8B,eAAejB,GAAMN,QAAQ2C,GAChCpD,MAAMC,KAAKmD,EAAKhD,UAAUC,OAAOC,GAASA,EAAMC,QAAQ,OAEnE,EACDV,EApHQwD,OAAS,CACdC,SAAU,CAAEC,KAAMC,QAASC,SAAS,GACpCC,SAAU,CAAEH,KAAMC,QAASC,SAAS,IACrC5D,EACM8D,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,0BACZ,CAAC,UAAW"}