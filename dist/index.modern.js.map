{"version":3,"file":"index.modern.js","sources":["../src/index.js"],"sourcesContent":["import { Controller } from '@hotwired/stimulus';\nimport '@kanety/stimulus-static-actions';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    autoOpen: { type: Boolean, default: false },\n    keepOpen: { type: Boolean, default: false }\n  };\n  static actions = [\n    ['element', 'click->toggle'],\n    ['element', 'click@window->closeAll'],\n    ['element', 'mouseover->open']\n  ];\n\n  get menus() {\n    return Array.from(this.element.querySelectorAll('ul'));\n  }\n\n  get isActive() {\n    return this.element.querySelector('.st-menu--opened') != null;\n  }\n\n  toggle(e) {\n    let item = e.target.closest('li');\n    if (this.hasMenu(item)) {\n      if (this.isOpened(item)) {\n        this.closeMenu(item.querySelector('ul'));\n      } else {\n        this.openMenus(item);\n      }\n      e.preventDefault();\n    } else {\n      if (!this.keepOpenValue) {\n        this.closeAllMenus();\n      }\n    }\n  }\n\n  open(e) {\n    let item = e.target.closest('li');\n    if (item && this.hasMenu(item)) {\n      if (this.isActive || this.autoOpenValue) this.openMenus(item);\n      e.preventDefault();\n    }\n  }\n\n  closeAll(e) {\n    if (!this.element.contains(e.target)) {\n      this.closeAllMenus();\n    }\n  }\n\n  hasMenu(item) {\n    return Array.from(item.children).some(child => child.matches('ul'));\n  }\n\n  isOpened(item) {\n    return item.matches(`.st-menu--opened`);\n  }\n\n  openMenus(item) {\n    this.closeAllMenus();\n    this.findAscMenus(item).concat(this.findChildMenus(item)).forEach(menu => this.openMenu(menu));\n  }\n\n  closeAllMenus() {\n    this.menus.forEach(menu => this.closeMenu(menu));\n  }\n\n  openMenu(menu) {\n    menu.parentNode.classList.add('st-menu--opened');\n  }\n\n  closeMenu(menu) {\n    menu.parentNode.classList.remove('st-menu--opened');\n  }\n\n  findAscMenus(item) {\n    let menu = item.parentNode;\n    if (menu == this.element) {\n      return [menu];\n    } else if (menu && menu.parentNode) {\n      return this.findAscMenus(menu.parentNode).concat([menu]);\n    } else {\n      return [];\n    }\n  }\n\n  findChildMenus(item) {\n    return Array.from(item.children).filter(child => child.matches('ul'));\n  }\n}\n"],"names":["Controller","menus","Array","from","this","element","querySelectorAll","isActive","querySelector","toggle","e","item","target","closest","hasMenu","isOpened","closeMenu","openMenus","preventDefault","keepOpenValue","closeAllMenus","open","autoOpenValue","closeAll","contains","children","some","child","matches","findAscMenus","concat","findChildMenus","forEach","menu","openMenu","parentNode","classList","add","remove","filter","values","autoOpen","type","Boolean","default","keepOpen","actions"],"mappings":"wGAI6BA,EAWvBC,YACF,OAAOC,MAAMC,KAAKC,KAAKC,QAAQC,iBAAiB,OAG9CC,eACF,OAAyD,WAA7CF,QAAQG,cAAc,oBAGpCC,OAAOC,GACL,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBT,KAAKU,QAAQH,IACXP,KAAKW,SAASJ,GAChBP,KAAKY,UAAUL,EAAKH,cAAc,OAElCJ,KAAKa,UAAUN,GAEjBD,EAAEQ,kBAEGd,KAAKe,eACRf,KAAKgB,gBAKXC,KAAKX,GACH,IAAIC,EAAOD,EAAEE,OAAOC,QAAQ,MACxBF,GAAQP,KAAKU,QAAQH,MACnBP,KAAKG,UAAYH,KAAKkB,gBAAelB,KAAKa,UAAUN,GACxDD,EAAEQ,kBAINK,SAASb,GACFN,KAAKC,QAAQmB,SAASd,EAAEE,SAC3BR,KAAKgB,gBAITN,QAAQH,GACN,OAAOT,MAAMC,KAAKQ,EAAKc,UAAUC,KAAKC,GAASA,EAAMC,QAAQ,OAG/Db,SAASJ,GACP,OAAOA,EAAKiB,QAAS,oBAGvBX,UAAUN,GACRP,KAAKgB,gBACLhB,KAAKyB,aAAalB,GAAMmB,OAAO1B,KAAK2B,eAAepB,IAAOqB,QAAQC,GAAQ7B,KAAK8B,SAASD,IAG1Fb,gBACEhB,KAAKH,MAAM+B,QAAQC,GAAQ7B,KAAKY,UAAUiB,IAG5CC,SAASD,GACPA,EAAKE,WAAWC,UAAUC,IAAI,mBAGhCrB,UAAUiB,GACRA,EAAKE,WAAWC,UAAUE,OAAO,mBAGnCT,aAAalB,GACX,IAAIsB,EAAOtB,EAAKwB,WAChB,OAAIF,GAAQ7B,KAAKC,QACR,CAAC4B,GACCA,GAAQA,EAAKE,gBACVN,aAAaI,EAAKE,YAAYL,OAAO,CAACG,IAE3C,GAIXF,eAAepB,GACb,OAAOT,MAAMC,KAAKQ,EAAKc,UAAUc,OAAOZ,GAASA,EAAMC,QAAQ,UArF1DY,OAAS,CACdC,SAAU,CAAEC,KAAMC,QAASC,SAAS,GACpCC,SAAU,CAAEH,KAAMC,QAASC,SAAS,MAE/BE,QAAU,CACf,CAAC,UAAW,iBACZ,CAAC,UAAW,0BACZ,CAAC,UAAW"}